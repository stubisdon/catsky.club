<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catsky Club</title>
    <!-- Ghost Portal (Members + Paid subscriptions) -->
    <!-- Required env vars (Vite): VITE_GHOST_URL, VITE_GHOST_CONTENT_API_KEY -->
    <!-- Portal loads from CDN in Ghost 6.0+ -->
    <script
      src="https://cdn.jsdelivr.net/ghost/portal@latest/umd/portal.min.js"
      data-ghost="%VITE_GHOST_URL%"
      data-key="%VITE_GHOST_CONTENT_API_KEY%"
      defer
    ></script>
    <!-- Workaround for Portal bug with undefined firstpromoter_account -->
    <script>
      // Patch fetch to ensure firstpromoter_account is always a string (not undefined)
      (function() {
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
          const promise = originalFetch.apply(this, args);
          const url = args[0];
          
          if (typeof url === 'string' && url.includes('/ghost/api/content/settings/')) {
            return promise.then(response => {
              if (!response.ok) return response;
              
              // Clone response to read it without consuming the original
              const clonedResponse = response.clone();
              
              return clonedResponse.json().then(data => {
                // Fix undefined firstpromoter_account
                if (data && data.settings) {
                  if (data.settings.firstpromoter_account === undefined || data.settings.firstpromoter_account === null) {
                    data.settings.firstpromoter_account = '';
                  }
                }
                
                // Return a new Response with the fixed data
                return new Response(JSON.stringify(data), {
                  status: response.status,
                  statusText: response.statusText,
                  headers: response.headers
                });
              }).catch(() => {
                // If JSON parsing fails, return original response
                return response;
              });
            });
          }
          
          return promise;
        };
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

